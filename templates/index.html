<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Einsatzplan - SLT</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'styles.css') }}" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css" />

    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename = 'fonts.css') }}" />
  </head>
  {% block title %}
    <body>
      <head>
        <p id="week-output"></p>
      </head>

      <main>
        <div class="top-container">
          <div id="login-frame">
            <form id="login-form" method="POST" action="{{ url_for('login') }}">
              {{ form.hidden_tag() }}
              {{ form.csrf_token }}
              <label for="username">Username:</label>
              {{ form.username }}
              <br /><br />
              <label for="password">Password:</label>
              {{ form.password }}
              <br /><br />
              <button type="submit" id="login-button">Login</button>
            </form>
            <form id="logout-form" method="POST" action="/logout">
              {{ form.csrf_token }}
            <button type="submit" id="logout-button">Logout</button>
            </form>
          </div>
          <div class="next-meetings">
            <table class="n-meetings-t">
              <thead>
                <tr>
                  <th>Datum</th>
                  <th>Uhrzeit</th>
                  <th>Raum</th>
                  <th>Teilnehmer</th>
                </tr>
              </thead>
              <tbody>
                {% if meetings_data %}
                  {% for meeting in meetings_data %}
                      {% if meeting != None %}
                          <tr>
                              <td>{{ meeting[1] }}</td>
                              <td>Von: {{ meeting[2] }} Bis: {{ meeting[3] }}</td>
                              <td>{{ meeting[4] }}</td>
                              <td>{{ meeting[6] }}</td>
                          </tr>
                      {% endif %}
                  {% endfor %}
                {% else %}
                    <!-- Create an empty table when no meetings_data is available -->
                    <tr>
                        <td colspan="4">Kein Meeting geplant..</td>
                    </tr>
                {% endif %}
              </tbody>
            </table> 
          </div>
          <div class="logo">
            <img src="https://www.slt-technologies.com/images/main_header_left-slt.jpg" alt="" />
          </div>
        </div>

        {% block content %}
          <div id="main-frame">
            <a href="/belegungsplan?user_role={{ user_role }}" id="link-belegungsplan">Belegungsplan</a>

            {% if user_role == 'admin' %}
            <div id="assign-frame">
              {% block assign_frame %}
                <div class="assign-m">
                  <h3>Einzelne Mitarbeiter zuweisen</h3>
                  <form id="assignForm" action="" method="POST">
                    <label id="a">
                      Mitarbeiter:</label>
                    <select name="personal_nr" id="dd-m" required>
                      <option value="" disabled selected>Mitarbeiter</option>
                      {% for row in data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <label>Von-Bis-Datum:</label>
                    <input type="text" id="date-select" name="datefilter" value="" required />
                    <label>
                      Projekt:</label>
                    <select name="project_id" id="dd-p">
                      <option value="" disabled selected>Projekt</option>
                      {% for row in project_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <label>
                      Auto:</label>
                    <select name="car_id" id="dd-car">
                      <!-- Autos aus Datenbank auslesen -->
                      <option value="0" disabled selected>Auto</option>
                      {% for row in car_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <label>
                      Ort:</label>
                      <select name="ort" id="dd-l" required>
                        <option value="vO">Vor-Ort</option>
                        <option value="iF">In Firma</option>
                      </select>
                    <label>
                      Zusatz:</label>
                      <select name="extra1" id="dd-x">
                        <option value="no" disabled selected>Weiteres..</option>
                        <option value="no">Kein Extra</option>
                        {% for row in extra_table_data1 %}
                          <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                        {% endfor %}
                      </select>
                      
                      <select name="extra2" id="dd-xx">
                        <option value="no" disabled selected>Weiteres..</option>
                        <option value="no">Kein Extra</option>
                        {% for row in extra_table_data2 %}
                          <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                        {% endfor %}
                      </select>
                      
                      <select name="extra3" id="dd-xxx">
                        <option value="no" disabled selected>Weiteres..</option>
                        <option value="no">Kein Extra</option>
                        {% for row in extra_table_data3 %}
                          <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                        {% endfor %}
                      </select>
                    <label>Hinweis:</label><textarea name="hinweis" id="hinweis" cols="30" rows="3"></textarea>
                    <br>
                    <div class="special">
                      <input type="radio" id="none" name="abw" value="0" checked>
                      <p>Keine</p>
                      <input type="radio" id="schule" name="abw" value="1">
                      <p>Schule</p>
                      <input type="radio" id="abwesend" name="abw" value="2">
                      <p>Abwesend</p>
                      <input type="radio" id="urlaub" name="abw" value="3">
                      <p>Urlaub</p>
                      <input type="radio" id="gleitzeit" name="abw" value="4">
                      <p>Gleitzeit</p>
                    </div>
                    <br />
                    <button class="confirm">Bestätigen</button>
                  </form>
                </div>
                <div class="group-create">
                  <h3>Gruppe erstellen & zuweisen</h3>
                  <p>Wähle mehrere Mitarbeiter aus, um eine Gruppe zu erstellen.</p>
                  <form id="group-form" action="" method="POST">
                    <select name="personal_nr_list" id="personal_nr_list" class="chosen-select" data-placeholder="Mitarbeiter auswählen.." multiple>
                      {% for row in data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <label>Von-Bis-Datum:</label>
                    <input type="text" id="date-select" name="datefilter-g" value="" required />
                    <label>
                      Projekt:</label>
                      <select name="project_id" id="dd-p-g" required>
                        <option value="" disabled selected>Projekt</option>
                        {% for row in project_table_data %}
                          <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                        {% endfor %}
                      </select>
                    <label>
                      Auto:</label>
                    <select name="car_id" id="dd-car-g">
                      <!-- Autos aus Datenbank auslesen -->
                      <option value="0" disabled selected>Auto</option>
                      {% for row in car_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <label>Ort:</label>
                    <select name="ort" id="dd-l-g" required>
                      <option value="vO">Vor-Ort</option>
                      <option value="iF">In Firma</option>
                    </select>
                    <label>
                      Zusatz:</label><select name="extra1" id="dd-x-g">
                        <option value="no" disabled selected>Weiteres..</option>
                        <option value="no">Kein Extra</option>
                        {% for row in extra_table_data4 %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                        {% endfor %}
                      </select>

                      <select name="extra2" id="dd-xx-g">
                        <option value="no" disabled selected>Weiteres..</option>
                        <option value="no">Kein Extra</option>
                        {% for row in extra_table_data5 %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                        {% endfor %}
                      </select>

                      <select name="extra3" id="dd-xxx-g">
                        <option value="no" disabled selected>Weiteres..</option>
                        <option value="no">Kein Extra</option>
                        {% for row in extra_table_data6 %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                        {% endfor %}
                      </select>
                    <label>Hinweis:</label>
                    <textarea name="hinweis" id="hinweis" cols="30" rows="3"></textarea>
                    <br />
                    <button class="confirm">Bestätigen</button>
                  </form>
                </div>

                <div class="add-data">
                  <h3>Füge Daten zu der Datenbank hinzu.</h3>
                  <form id="submit_m_add" action="" method="POST">
                    <label>
                      Neuen Mitarbeiter:<br />
                      <input type="number" name="personal_nr" required placeholder="Personal-Nr." />
                      <input type="text" name="vorname" required placeholder="Vorname" />
                      <input type="text" name="nachname" required placeholder="Nachname" />
                      <select name="bereich" required id="">
                        <option value="" disabled selected>Bereich</option>
                        <option value="Schlosser">Schlosser</option>
                        <option value="Dreher & Fräser">Dreher & Fräser</option>
                        <option value="Elektriker">Elektriker</option>
                        <option value="Freie Mitarbeiter">Freie Mitarbeiter</option>
                        <option value="Büro">Büro</option>
                        <option value="Hauswart">Hauswart</option>
                      </select>
                    </label>
                    <button type="submit">Erstellen</button>
                  </form>
                  <br />
                  <label>Neuen Kunden:</label>
                  <form id="submit_c_add" action="" method="POST">
                    <input type="number" name="customer_id" required placeholder="Kunden-Nr." />
                    <input type="text" name="customer_name" required placeholder="Kunden-Name" />
                    <button type="submit">Erstellen</button>
                  </form>
                  <br />
                  <label>Neues Projekt:</label>
                  <br />
                  <form id="submit_p_add" action="" method="POST">
                    <input type="number" name="project_id" required placeholder="Projekt-Nr." />
                    <input type="text" name="project_name" required placeholder="Projekt-Name" />
                    <select name="customer_id" required id="dd-c">
                      <option value="" disabled selected>Kunde</option>
                      {% for row in customer_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit">Erstellen</button>
                  </form>
                  <br />
                  <label>Neues Auto:</label>
                  <br />
                  <form id="submit_car_add" action="" method="POST">
                    <input type="text" name="car_id" required placeholder="Kennzeichen.." />
                    <button type="submit">Erstellen</button>
                  </form>
                  <br />
                  <label>Neues Extra:</label>
                  <br />
                  <form id="submit_extra_add" action="" method="POST">
                    <input type="text" name="extra_id" required placeholder="Kürzel" />
                    <input type="text" name="extra_name" required placeholder="Bezeichnung" />
                    <button type="submit">Erstellen</button>
                  </form>
                  <br />
                </div>
                <div class="delete-data">
                  <h3>Lösche Daten aus der Datenbank.</h3>

                  <label>Mitarbeiter löschen:</label>
                  <form id="submit_m_delete" action="" method="POST">
                    <select name="personal_nr" id="" required>
                      <option value="" disabled selected>Mitarbeiter</option>
                      {% for row in data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit">Löschen</button>
                  </form>

                  <br />
                  <label>Kunden löschen:</label>
                  <form id="submit_c_delete" action="" method="POST">
                    <select name="kunden-delete" id="" required>
                      <option value="" disabled selected>Kunde</option>
                      {% for row in customer_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit">Löschen</button>
                  </form>

                  <br />
                  <label>Projekt löschen:</label>
                  <form id="submit_p_delete" action="" method="POST">
                    <select name="project-delete" id="" required>
                      <option value="" disabled selected>Projekt</option>
                      {% for row in project_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit">Löschen</button>
                  </form>

                  <br />
                  <label>Auto löschen:</label>
                  <form id="submit_car_delete" action="" method="POST">
                    <select name="car-delete" id="" required>
                      <option value="" disabled selected>Auto</option>
                      {% for row in car_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit">Löschen</button>
                  </form>

                  <br />
                  <label>Extra löschen:</label>
                  <form id="submit_extra_delete" action="" method="POST">
                    <select name="extra-delete" id="" required>
                      <option value="" disabled selected>Extra</option>
                      {% for row in extra_table_data %}
                        <option value="{{ row[0] }}">{{ row[0] }}: {{ row[1] }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit">Löschen</button>
                  </form>
                </div>
              {% endblock %}
            </div>
          {% endif %}

            <h1>Einsatzplan</h1>
            <div class="legende">
              <table>
                <tr>
                  <td style="background-color: #fff;"><b>vO</b> = vor Ort</td>
                  <td style="background-color: #fff;"><b>iF</b> = i.d. Firma</td>
                  <td style="background-color: #fff;"><b>ST.</b> = Stundenzettel</td>
                  <td style="background-color: #fff;"><b>H</b> = Hotel</td>
                  <td style="background-color: #fff;"><b>T</b> = Telefon</td>
                  <td style="background-color: chartreuse;">Farbig = Gruppe</td>
                  <td style="background-color: grey;">Feiertag</td>
                  <td style="background-color: grey;"><b>B</b><br>= Feiertag in Bayern/Süden</td>
                  <td style="background-color: #000; color: #fff;">Schule</td>
                  <td style="background-color: #FFFF00;">Abwesend</td>
                  <td style="background-color: #0000FF; color: #fff;">Urlaub</td>
                  <td style="background-color: #89CFF0;">Gleitzeit</td>
                </tr>
              </table>
            </div>
            <button onclick="prevWeek()" id="b-week-c">Vorherige Woche</button>
            <button onclick="nextWeek()" id="b-week-c">Nächste Woche</button>
            <button onclick="resetWeek()" id="b-week-c">HEUTE</button>
            <div class="tables-container" style="padding-top: 10px;">
              <p class="week-number" id="w-n-1">KW {{ kw_1 }}</p>
              <p class="week-number" id="w-n-2">KW {{ kw_2 }}</p>
              <table class="week-table1" id="{% if kw_1 == current_week_number %}current-week-table{% endif %}">
                <thead>
                  <tr>
                    <th>P-Nr.</th>
                    <th>Name</th>
                    {% for date in week_dates1 %}
                      <th>{{ date }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% if data %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Elektriker</strong>
                      </td>
                      {% for day in week_days1 %}
                        <th colspan="1">{{ day }}</th>
                      {% endfor %}
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Elektriker' %}
                        <tr>
                          <td>{{ row[0] }}</td>
                          <td>{{ row[1] }}</td>
                          {% for date in week_dates1 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Schlosser</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Schlosser' %}
                        <tr>
                          <td>{{ row[0] }}</td>
                          <td>{{ row[1] }}</td>
                          {% for date in week_dates1 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Hauswart</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Hauswart' %}
                        <tr>
                          <td>{{ row[0] }}</td>
                          <td>{{ row[1] }}</td>
                          {% for date in week_dates1 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Büro</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Büro' %}
                        <tr>
                          <td>{{ row[0] }}</td>
                          <td>{{ row[1] }}</td>
                          {% for date in week_dates1 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Dreher & Fräser</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Dreher & Fräser' %}
                        <tr>
                          <td>{{ row[0] }}</td>
                          <td>{{ row[1] }}</td>
                          {% for date in week_dates1 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}                    
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Freie Mitarbeiter</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Freie Mitarbeiter' %}
                        <tr>
                          <td>{{ row[0] }}</td>
                          <td>{{ row[1] }}</td>
                          {% for date in week_dates1 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                  {% else %}
                    <tr>
                      <td colspan="5">No data available</td>
                    </tr>
                  {% endif %}
                </tbody>
              </table>
              <table class="week-table2" id="{% if kw_2 == current_week_number %}current-week-table{% endif %}">
                <thead>
                  <tr>
                    <th id="m-pc-row">P-Nr.</th>
                    <th id="m-pc-row">Name</th>
                    {% for date in week_dates2 %}
                      <th>{{ date }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  {% if data %}
                    <tr>
                      <td colspan="0" style="border: 0; display: none;">
                        <strong id="k-m">Elektriker</strong>
                      </td>
                      {% for day in week_days2 %}
                        <th colspan="1">{{ day }}</th>
                      {% endfor %}
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Elektriker' %}
                        <tr>
                          <td id="m-pc-row">{{ row[0] }}</td>
                          <td id="m-pc-row">{{ row[1] }}</td>
                          {% for date in week_dates2 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Schlosser</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Schlosser' %}
                        <tr>
                          <td id="m-pc-row">{{ row[0] }}</td>
                          <td id="m-pc-row">{{ row[1] }}</td>
                          {% for date in week_dates2 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Hauswart</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Hauswart' %}
                        <tr>
                          <td id="m-pc-row">{{ row[0] }}</td>
                          <td id="m-pc-row">{{ row[1] }}</td>
                          {% for date in week_dates2 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Büro</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Büro' %}
                        <tr>
                          <td id="m-pc-row">{{ row[0] }}</td>
                          <td id="m-pc-row">{{ row[1] }}</td>
                          {% for date in week_dates2 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Dreher & Fräser</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Dreher & Fräser' %}
                        <tr>
                          <td id="m-pc-row">{{ row[0] }}</td>
                          <td id="m-pc-row">{{ row[1] }}</td>
                          {% for date in week_dates2 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                    
                    
                    <tr>
                      <td colspan="2" style="border:0;">
                        <strong id="k-m">Freie Mitarbeiter</strong>
                      </td>
                    </tr>
                    {% for row in data %}
                      {% if row[3] == 'Freie Mitarbeiter' %}
                        <tr>
                          <td id="m-pc-row">{{ row[0] }}</td>
                          <td id="m-pc-row">{{ row[1] }}</td>
                          {% for date in week_dates2 %}
                            <td class="assignment-cell {% if date in n_holidays %}n_holiday{% endif %}" id="t-a-field">
                              {% for assignment in assignment_table_data %}
                                {% set assignment_found = false %}
                                {% if row[0] == assignment[1] and assignment[4] <= date <= assignment[5] %}
                                  {% set assignment_found = true %}
                                  <div data-assignment-id="{{ assignment[0] }}" data-start-date="{{ assignment[4] }}" data-group-id="{{ assignment[11] }}" data-group-color="" data-abw-id="{{ assignment[13] }}" data-abw-color="">
                                    <b>{{ assignment[3] }}</b>
                                    {{ assignment[14] }}                              
                                    <br />
                                    {% for car in car_table_data %}
                                      {% if car[0] == assignment[2] %}
                                        {% if car[0] != 0 %}
                                          {{ car[1] }}
                                          <br />
                                        {% endif %}
                                      {% endif %}
                                    {% endfor %}
                                    {% if assignment[7] != 'no' and assignment[7] != 'null' %}
                                      {{ assignment[7] }}
                                    {% endif %}
                                    {% if assignment[8] != 'no' and assignment[8] != 'null' %}
                                      {{ assignment[8] }}
                                    {% endif %}
                                    {% if assignment[9] != 'no' and assignment[9] != 'null' %}
                                      {{ assignment[9] }}
                                    {% endif %}
                                    {{ assignment[10] }}
                                    {% if user_role == "admin" and date == assignment[4] %}
                                      <button class="delete-btn" data-assignment-id="{{ assignment[0] }}">Löschen</button>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                              {% if date in s_holidays %}
                                <div class="south-holiday-indicator">B</div>
                              {% endif %}
                              {% if not assignment_found %}
                                <!-- Create an empty td when no assignment is found -->
                              {% endif %}
                            </td>
                          {% endfor %}
                        </tr>
                      {% endif %}
                    {% endfor %}
                  {% else %}
                    <tr>
                      <td colspan="5">No data available</td>
                    </tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
            <br />
          </div>
        {% endblock %}
      </main>

      <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
      <script src="{{ url_for('static', filename = 'javascript.js') }}"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          document
            .getElementById("login-form")
            .addEventListener("submit", function (e) {
              e.preventDefault();
              var formData = new FormData(this);
              fetch("/login", {
                method: "POST",
                body: formData,
              })
                .then((response) => response.json())
                .then((data) => {
                  console.log("Login Response:", data); // Log the response to the console
                  if (data.status === "success") {
                    console.log("User Role:", data.user_role); // Log the user role to the console
                    const userRole = data.user_role || "user";
                    updateWeekURL(userRole);
                    window.location.href = `/?user_role=${userRole}`;
                  } else {
                    alert("Falscher username oder password. Versuche es erneut.");
                  }
                })
                .catch((error) => {
                  console.error("Error:", error);
                });
            });
        });

        document.getElementById("logout-form").addEventListener("submit", function(event) {
          event.preventDefault();
          fetch("/logout", {
              method: "POST",
              credentials: "same-origin"  // Include this line for session cookie to be sent
          })
          .then(response => {
              if (response.redirected) {
                  window.location.href = response.url;  // Redirect to the index page after logout
              }
          })
          .catch(error => {
              console.error("Error:", error);
          });
      });
        
        $(document).ready(function () {
          $('#date-range').daterangepicker({
            startDate: '2023-01-01',
            endDate: '2035-12-31',
            minDate: '2023-01-01',
            maxDate: '2035-12-31'
          })
        })

        function navigateWeeks(offset) {
          const userRole = getUrlParameter('user_role') || 'user';
          const currentWeek1 = parseInt('{{ week_number1 }}');
          const currentWeek2 = parseInt('{{ week_number2 }}');
          const kw1 = parseInt('{{ kw_1 }}');
          const kw2 = parseInt('{{ kw_2 }}');
          const newWeek1 = currentWeek1 + offset;
          const newWeek2 = currentWeek2 + offset;
          const newKW1 = kw1 + offset;
          const newKW2 = kw2 + offset;
        
          window.location.href = `/?user_role=${userRole}&week_number1=${newWeek1}&week_number2=${newWeek2}&kw_1=${newKW1}&kw_2=${newKW2}`;
        }

        function updateWeekURL(userRole) {
          const currentURL = new URL(window.location.href);
          currentURL.searchParams.set('user_role', userRole);
          window.history.replaceState({}, document.title, currentURL.href);
        }
        
        function prevWeek() {
          navigateWeeks(-1);
        }
        
        function nextWeek() {
          navigateWeeks(1);
        }
        
        function resetWeek() {
          const userRole = getUrlParameter('user_role') || 'user';
          window.location.href = `/?user_role=${userRole}`;
        }
        
        function getUrlParameter(name) {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get(name);
        }
      </script>

      <script src="https://cdn.jsdelivr.net/npm/brython@3.9.1/brython.min.js"></script>
      <footer>
        <tr>
          <td style="background-color:#287429;" width="100%">
            <table cellspacing="0" cellpadding="0" border="0" width="800">
              <tbody>
                <tr>
                  <td width="100%" height="30" align="center" valign="center" style="font-size:10px;">
                    © 2024 SLT-Technologies GmbH &amp; Co. KG • Telefon +49 (421) 66 05 8-0 • Fax +49 (421) 66 05 8-40 • Email
                    <a href="mailto:info@slt-technologies.com">info@slt-technologies.com</a>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </footer>
    </body>
  {% endblock %}

  <!-- Jan Knijnenburg - SLT Technologies GmbH & Co. KG -->
</html>
